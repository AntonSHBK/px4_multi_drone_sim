### base_controller.md

#### **Описание базового класса контроллера**

Базовый класс контроллеров (`BaseDroneController`) предназначен для управления дроном через взаимодействие с PX4. Он реализует основные методы и логику, которые являются фундаментом для разработки расширенных контроллеров. Этот класс обеспечивает обработку команд, передачу сообщений и синхронизацию состояния дрона с автопилотом PX4 через ROS 2.

---

#### **Основные функции `BaseDroneController`**

1. **Инициализация контроллера:**
   - Конструктор класса принимает параметры:
     - `drone_id`: уникальный идентификатор дрона.
     - `drone_type`: тип дрона.
     - `default_position` и `default_orientation`: начальные координаты и ориентация.
   - Инициализация топиков ROS для публикации команд и подписки на данные телеметрии.

2. **QoS-профили:**
   - Определены стандартные профили QoS:
     - `qos_profile_reliable`: для гарантированной доставки сообщений.
     - `qos_profile_unreliable`: для сообщений с меньшей задержкой, но без гарантии доставки.

3. **Методы логирования:**
   - `log_info` и `log_error`: вывод информации о работе контроллера и возможных ошибках.

4. **Геометрические преобразования:**
   - Используются для перехода между разными системами координат (например, ENU, NED) и преобразования данных ориентации.

---

#### **Геометрические преобразования**

Базовый контроллер включает функции для обработки геометрических данных, таких как позиции, скорости и ориентация. Преобразования необходимы для синхронизации данных между различными системами координат и PX4.

- **ENU и NED:**
  - ENU (East-North-Up) используется в ROS.
  - NED (North-East-Down) — стандартная система в PX4.
  - Методы контроллера преобразуют данные между этими системами.

- **Примеры преобразований:**
  - Метод `enu_to_ned`: преобразует вектор из системы координат ENU в NED.
  - Метод `convert_to_FLU`: преобразует координаты в систему координат дрона (Forward-Left-Up).

Эти функции используют библиотеки `numpy` и `scipy` для выполнения матричных преобразований и вычисления угловых ориентаций.

---

#### **Классы данных (BaseData и производные)**

Для представления данных о позиции, ориентации и скорости используются специализированные классы:

1. **`BaseData`:**
   - Базовый класс для всех типов данных.
   - Содержит общие методы, такие как:
     - Преобразование данных в словарь.
     - Сравнение объектов.

2. **`PositionData`:**
   - Описывает позицию в пространстве.
   - Атрибуты:
     - `x`, `y`, `z`: координаты.
   - Методы:
     - Поддержка преобразований между системами координат.

3. **`VelocityData`:**
   - Представляет линейные и угловые скорости.
   - Атрибуты:
     - `vx`, `vy`, `vz`: линейные скорости.
     - `roll_rate`, `pitch_rate`, `yaw_rate`: угловые скорости.

4. **`OrientationData`:**
   - Представляет ориентацию дрона.
   - Атрибуты:
     - `roll`, `pitch`, `yaw`: углы ориентации.
     - Методы для преобразования между кватернионами и углами Эйлера.

5. **`QuaternionData`:**
   - Хранит данные ориентации в формате кватернионов.
   - Используется для точных вычислений и преобразований.

---

#### **Особенности и преимущества**

- **Модульность:**
  - Геометрические преобразования и классы данных изолированы от основного контроллера, что упрощает расширение функциональности.

- **Универсальность:**
  - Контроллер поддерживает работу с разными системами координат, позволяя интегрировать его в сложные проекты.

- **Простота использования:**
  - Интуитивный API для взаимодействия с данными о позиции, скорости и ориентации.
