### drone_states.md

#### **Система статусов дрона**

Система статусов дрона реализована с использованием шаблона проектирования "Состояние" (State Pattern). Каждый статус дрона описывает определённое поведение, что позволяет эффективно управлять сложной логикой переходов между состояниями. Такой подход обеспечивает модульность, простоту расширения и улучшает читаемость кода.

---

### **1. Общий обзор статусов**

Статусы представляют собой классы, которые управляют поведением дрона в зависимости от текущей задачи или этапа выполнения. Каждый статус отвечает за:
- Инициализацию специфической логики.
- Выполнение операций, связанных с этим состоянием.
- Завершение или переход в другое состояние.

---

### **2. Основные статусы**

#### **IdleState (Режим ожидания)**
- Описание:
  - Дрон находится в режиме ожидания, не выполняя активных задач.
  - Это начальное состояние дрона после включения.
- Основные функции:
  - Ожидание команды для перехода в другое состояние.
  - Проверка системных параметров перед арминга.
- Пример использования:
  ```python
  drone.set_state(IdleState())
  ```

#### **ArmingState (Армирование)**
- Описание:
  - Дрон проходит процесс подготовки к полёту.
  - Включение моторов и проверка безопасности.
- Основные функции:
  - Отправка команды арминга PX4.
  - Проверка успешного завершения арминга.
- Пример использования:
  ```python
  drone.set_state(ArmingState())
  ```

#### **TakeoffState (Взлет)**
- Описание:
  - Дрон выполняет вертикальный взлёт до заданной высоты.
- Основные функции:
  - Установка целевой высоты.
  - Переход в режим удержания позиции после взлёта.
- Пример использования:
  ```python
  drone.set_state(TakeoffState(target_height=10.0))
  ```

#### **LoiterState (Удержание позиции)**
- Описание:
  - Дрон зависает на текущей позиции, удерживая стабильное положение.
- Основные функции:
  - Контроль положения и ориентации.
  - Поддержание связи с PX4 для обновления параметров.
- Пример использования:
  ```python
  drone.set_state(LoiterState())
  ```

#### **OffboardState (Режим внешнего управления)**
- Описание:
  - Дрон управляется внешними командами, переданными через Offboard.
- Основные функции:
  - Приём целевых точек и скоростей.
  - Обновление параметров траектории в режиме реального времени.
- Пример использования:
  ```python
  drone.set_state(OffboardState())
  ```

#### **LandingState (Посадка)**
- Описание:
  - Дрон выполняет плавную посадку на заданную точку.
- Основные функции:
  - Управление скоростью снижения.
  - Проверка успешного завершения посадки.
- Пример использования:
  ```python
  drone.set_state(LandingState())
  ```

#### **DisarmState (Разармирование)**
- Описание:
  - Дрон выключает моторы и завершает активные задачи.
- Основные функции:
  - Отправка команды разармирования PX4.
  - Проверка завершения разармирования.
- Пример использования:
  ```python
  drone.set_state(DisarmState())
  ```

---

### **3. Логика переходов между статусами**

Переходы между состояниями управляются логикой внутри каждого статуса. Например:
- **Idle → Arming:** После получения команды на арминг.
- **Arming → Takeoff:** После успешного арминга и получения команды на взлёт.
- **Takeoff → Loiter:** После достижения заданной высоты.
- **Loiter → Offboard:** При активации режима внешнего управления.
- **Offboard → Landing:** После команды на завершение миссии.
- **Landing → Disarm:** После успешной посадки.

Каждое состояние проверяет условия выполнения и триггерит переход в следующее состояние при необходимости.

---

### **4. Преимущества системы статусов**

1. **Модульность:**
   - Каждое состояние изолировано и отвечает за свою логику.
   - Упрощается добавление новых состояний (например, планирование миссий).

2. **Простота тестирования:**
   - Логику каждого статуса можно тестировать независимо от других состояний.

3. **Улучшенная читаемость:**
   - Разделение логики управления на уровни позволяет легче понимать процесс выполнения задач.

4. **Гибкость:**
   - Легко изменять или добавлять новые сценарии переходов между статусами.