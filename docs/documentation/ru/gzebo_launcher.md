### gzebo_launcher.md

#### **Описание скрипта `gazebo_server.py`**

Скрипт `gazebo_server.py` предназначен для автоматической настройки и запуска симуляции Gazebo с использованием кастомных моделей и миров. Он позволяет загружать стандартные и пользовательские модели, управлять их расположением, а также запускать симуляцию с необходимыми параметрами, включая поддержку безголового режима (headless).

---

### **Основные функции**

#### **1. `run_simulation_gazebo`**
Функция отвечает за:
- Загрузку и подготовку моделей Gazebo.
- Настройку директории для моделей и миров.
- Запуск симуляции Gazebo с заданным миром и параметрами.

##### **Аргументы функции**
- `world` (str): Имя файла мира для симуляции (без расширения, например, `"default"`).
- `gz_partition` (str): Разделение ресурсов Gazebo для работы в распределённой среде.
- `gz_ip` (str): IP-адрес для сетевого интерфейса.
- `model_download_source` (str): URL для загрузки моделей Gazebo.
- `px4_model_store` (str): Директория для хранения стандартных моделей PX4.
- `custom_model_store` (str): Директория для пользовательских моделей.
- `custom_model_store_other` (List[str]): Дополнительные пути для пользовательских моделей.
- `overwrite` (bool): Флаг для перезаписи существующих моделей.
- `headless` (bool): Флаг для запуска в безголовом режиме (без графического интерфейса).

##### **Возвращаемое значение**
- `ExecuteProcess`: Объект, представляющий процесс запуска Gazebo.

---

### **Описание логики работы**

#### **1. Подготовка моделей**
- Проверяет наличие моделей в директории `px4_model_store`.
- Если модели отсутствуют или установлен флаг `overwrite`, загружает их из указанного источника (`model_download_source`).
- Распаковывает архив, организует файлы по директориям `models` и `worlds`.

#### **2. Настройка путей**
- Устанавливает переменную среды `GZ_SIM_RESOURCE_PATH`, которая определяет пути к моделям и мирам для симуляции.

#### **3. Формирование команды запуска**
- Собирает команду для запуска симуляции:
  - Указывает путь к файлу мира.
  - Добавляет параметры для безголового режима (`-s`) или сетевых настроек (`gz_partition`, `gz_ip`).

#### **4. Запуск симуляции**
- Использует `ExecuteProcess` для запуска Gazebo с заданными параметрами.

---

### **Ключевые переменные**

1. **`px4_model_store`:**
   - Локальная директория для хранения моделей PX4.
   - По умолчанию: `~/simulation-gazebo`.

2. **`model_download_source`:**
   - URL для загрузки стандартных моделей PX4.
   - По умолчанию: `https://github.com/PX4/PX4-gazebo-models/archive/refs/heads/main.zip`.

3. **`GZ_SIM_RESOURCE_PATH`:**
   - Список путей для поиска моделей и миров Gazebo.

4. **`gz_cmd`:**
   - Команда для запуска симуляции. Формируется в зависимости от указанных параметров.

---

### **Использование**

1. **Запуск симуляции с настройками по умолчанию:**
   ```bash
   python3 gazebo_server.py
   ```

2. **Пример запуска кастомного мира с дополнительными настройками:**
   ```python
   from gazebo_server import run_simulation_gazebo

   run_simulation_gazebo(
       world="custom_world",
       gz_partition="simulation_partition",
       gz_ip="192.168.1.100",
       model_download_source="https://example.com/custom_models.zip",
       px4_model_store="/home/user/gazebo_models",
       custom_model_store="/home/user/custom_worlds",
       custom_model_store_other=["/opt/additional_models", "/usr/share/models"],
       overwrite=True,
       headless=True
   )
   ```

3. **Настройка кастомных моделей и миров:**
   - Укажите директорию для пользовательских моделей через аргумент `custom_model_store`.
   - Добавьте дополнительные пути через `custom_model_store_other`.

---

### **Пример команды запуска Gazebo**

После выполнения скрипта будет сформирована команда:
```bash
gz sim -r ~/simulation-gazebo/worlds/custom_world.sdf -s
```
Где:
- `-r`: Указывает путь к файлу мира.
- `-s`: Запуск в безголовом режиме (если указан флаг `headless`).

---

### **Преимущества использования**

1. **Автоматизация настройки:**
   - Скрипт автоматически загружает, распаковывает и организует модели, что упрощает настройку симуляции.

2. **Поддержка кастомных моделей:**
   - Легко интегрировать пользовательские модели и миры.

3. **Масштабируемость:**
   - Поддержка разделения ресурсов и сетевых интерфейсов для распределённых систем.

4. **Удобство разработки:**
   - Запуск Gazebo в безголовом режиме позволяет экономить ресурсы при тестировании.

---

### **Заключение**

Скрипт `gazebo_server.py` обеспечивает удобный интерфейс для работы с Gazebo, автоматизируя процесс подготовки и запуска симуляции. Он поддерживает гибкую настройку и масштабируемость, что делает его подходящим инструментом для работы с проектами на основе PX4 и ROS.