### Архитектура системы

Этот документ описывает архитектуру системы управления группой беспилотных летательных аппаратов (БЛА), подчеркивая её модульность, масштабируемость и возможность расширения. Архитектура сочетает централизованное управление группой с распределенными модулями управления отдельными дронами, обеспечивая надежность работы и адаптивность.

---

#### **1. Общий обзор архитектуры**
Архитектура системы разработана для управления группой БЛА с использованием ROS 2 и PX4. Основные компоненты включают:
- **Централизованное устройство управления (ЦУ):** собирает телеметрию, вычисляет действия и отправляет команды дронам.
- **Контроллеры дронов:** управляют работой каждого дрона и выполняют полученные команды.
- **Система коммуникации:** обеспечивает обмен сообщениями между компонентами с использованием топиков и сервисов ROS 2.
- **Среда симуляции:** реализована на базе Gazebo для моделирования реальных физических условий.

Архитектура поддерживает модульность, изолируя каждую функцию в отдельные пакеты и компоненты, что упрощает добавление новых возможностей и модификацию системы.

---

#### **2. Основные компоненты**

##### **2.1 Централизованное устройство управления (ЦУ)**
ЦУ выполняет следующие задачи:
- Сбор телеметрических данных со всех дронов.
- Вычисление групповых действий для достижения общей цели.
- Передача команд отдельным дронам через топики ROS.

##### **2.2 Контроллер дронов**
Каждый дрон управляется индивидуальным контроллером, который отвечает за:
- Поддержание текущего состояния (например, ожидание, взлет, полет).
- Интерпретацию высокоуровневых команд и их преобразование в инструкции, совместимые с PX4.
- Публикацию данных телеметрии, таких как положение, скорость и ориентация.

Контроллеры реализуют **шаблон проектирования "Состояние"**, где каждое состояние (например, взлет, удержание позиции) представлено классом с методами для инициализации, выполнения и логики перехода.

##### **2.3 Система коммуникации**
Система использует топики и сервисы ROS 2 для:
- **Телеметрии:** публикация актуальных данных о состоянии дронов.
- **Команд:** передача высокоуровневых инструкций дронам.
- **Обратной связи:** отчет о выполнении команд и их завершении.

##### **2.4 Среда симуляции**
- **Gazebo Ignition** моделирует дронов, окружающую среду и физические процессы.
- Конфигурация YAML определяет параметры дронов и их начальные позиции.
- Симуляция поддерживает тестирование сценариев различной сложности, включая координацию нескольких дронов и обход препятствий.

---

#### **3. Логика работы**

##### **Шаг 1: Инициализация**
- ЦУ запускает симуляционную среду на основе заранее заданной конфигурации.
- В среде Gazebo размещаются дроны, каждый с экземпляром PX4.

##### **Шаг 2: Сбор данных**
- Телеметрические данные (позиция, ориентация, скорость) публикуются в топики ROS.
- ЦУ собирает и анализирует телеметрию для оценки состояния группы.

##### **Шаг 3: Принятие решений**
- ЦУ рассчитывает действия на основе целей, ограничений и данных об окружающей среде.
- Действия кодируются в формате высокоуровневых JSON-команд.

##### **Шаг 4: Выполнение команд**
- Команды отправляются в контроллеры отдельных дронов.
- Контроллеры преобразуют высокоуровневые команды в сообщения, совместимые с PX4, через MAVROS.

##### **Шаг 5: Обратная связь и мониторинг**
- Контроллеры дронов сообщают статус выполнения команд в ЦУ.
- RViz предоставляет визуализацию состояния дронов и их траекторий в реальном времени.

---

#### **4. Модульный дизайн**

##### **4.1 Пакеты и модули**
- **Пакет группового управления:** управляет динамикой группы и распределяет команды.
- **Пакет индивидуального управления:** обрабатывает состояния и телеметрию для одного дрона.
- **Пакет обработки команд:** интерпретирует и обрабатывает JSON-команды.
- **Модуль навигации:** реализует планирование траектории и обход препятствий.
- **Пакет симуляции:** отвечает за запуск и настройку среды Gazebo.

##### **4.2 Расширяемость**
- Для добавления нового дрона достаточно задать параметры в YAML-файле.
- Новые команды реализуются путем наследования класса `BaseGCommand`.
- Дополнительные функции, такие как алгоритмы роевого интеллекта, можно интегрировать как отдельные модули.

---

#### **5. Преимущества**

1. **Модульность:**
   - Четкое разделение логики управления группой и отдельными дронами.
   - Простота добавления или модификации компонентов без влияния на всю систему.

2. **Масштабируемость:**
   - Поддержка динамического добавления новых дронов и контроллеров.
   - Адаптация как к симуляционной, так и к реальной среде.

3. **Гибкость:**
   - Высокоуровневые команды упрощают логику управления.
   - ROS 2 обеспечивает надежную распределенную коммуникацию.

4. **Мониторинг в реальном времени:**
   - Телеметрия и инструменты визуализации, такие как RViz, упрощают отладку и анализ.

---

#### **6. Ограничения**
- Зависимость от MAVROS и PX4 может вызывать небольшие задержки при высоких нагрузках.
- Точность симуляции может варьироваться из-за ограничений оборудования или ПО.