# **Статья: Управление группой беспилотных летательных аппаратов**
- [**Статья: Управление группой беспилотных летательных аппаратов**](#статья-управление-группой-беспилотных-летательных-аппаратов)
    - [Аннотация](#аннотация)
    - [1. **Введение**](#1-введение)
    - [2. **Обзор существующих решений**](#2-обзор-существующих-решений)
    - [3. **Архитектура системы**](#3-архитектура-системы)
    - [4. **Реализация высокоуровневого контроллера**](#4-реализация-высокоуровневого-контроллера)
    - [5. **Проведение эксперимента**](#5-проведение-эксперимента)
    - [6. **Анализ  результатов**](#6-анализ--результатов)
    - [7. **Заключение**](#7-заключение)
    - [Заключение](#заключение)
    - [**Список литературы**](#список-литературы)

### Аннотация

В статье представлена разработка и тестирование системы управления группой беспилотных летательных аппаратов (БЛА), реализованной с использованием фреймворка ROS 2, программного обеспечения PX4 и симуляционной среды Gazebo. Основное внимание уделено реализации высокоуровневого контроллера, использующего G-команды для стандартизации управления дронами. Проведённые эксперименты включали тестирование точности выполнения команд, координации действий дронов и анализа траекторий движения.

Результаты показали высокую точность выполнения заданий, таких как взлёт, перемещение и стабилизация, однако были выявлены недочёты, связанные с погрешностью начального позиционирования и асинхронностью выполнения команд. В статье предложены рекомендации по улучшению системы, включая разработку механизмов калибровки и синхронизации, а также внедрение дополнительных функциональных модулей, таких как одометрия и автономная навигация. Работа закладывает основу для дальнейшего развития систем управления БЛА, способных эффективно функционировать как в симуляционной, так и в реальной среде.

###  1. **Введение**

С развитием технологий беспилотные летательные аппараты (БПЛА) становятся всё более популярными в различных отраслях, включая логистику, сельское хозяйство, строительство, безопасность и научные исследования. Их гибкость и способность эффективно выполнять задачи в сложных условиях привели к значительному увеличению количества применяемых устройств. Однако рост масштабов их использования требует разработки более эффективных методов управления, особенно в сценариях, где один оператор должен координировать несколько дронов одновременно.

Современные подходы к управлению беспилотными летательными аппаратами (БПЛА) основываются на применении передовых программно-аппаратных платформ, таких как PX4 Autopilot и фреймворк ROS 2, которые стали стандартом де-факто в области робототехники. PX4 представляет собой универсальную открытую платформу для управления полётами, обеспечивающую поддержку множества типов аппаратов и широкий спектр возможностей, включая высокую точность навигации, автоматизацию задач и интеграцию с различными сенсорами [1]. Аналогом PX4 является платформа ArduPilot, предоставляющая богатую функциональность для управления БПЛА [2]. С другой стороны, ROS 2 (Robot Operating System) предоставляет гибкий инструмент для разработки распределённых систем управления, что особенно важно для координации групп БПЛА и их взаимодействия в динамических средах [3].

Одним из перспективных подходов является внедрение концепции G-команд, вдохновлённой числовым программным управлением (ЧПУ). Использование подобных команд позволяет стандартизировать взаимодействие между различными компонентами системы, выступая в роли своеобразного интерфейса или API для обмена данными и управляющими командами. G-команды задают высокоуровневую логику выполнения задач, обеспечивая простоту интеграции новых функциональных возможностей и модулей [4]. Этот подход упрощает разработку сложных систем управления и повышает их совместимость с различным оборудованием и программным обеспечением.

Цель данной работы — разработать и протестировать высокоуровневый контроллер для управления БПЛА с использованием G-команд, функционирующий на базе PX4 и ROS 2. Контроллер должен обеспечить передачу и выполнение упрощённых команд, таких как перемещение в точку, линейное перемещение, перемещение по круговой орбите с последующим мониторингом состояния дронов в режиме реального времени. 

Для валидации предложенного подхода была создана симуляционная среда, позволяющая оценить эффективность и надёжность разработанной системы. В работе представлены структура и принципы функционирования предложенного контроллера.

### 2. **Обзор существующих решений**

Современные решения для управления беспилотными летательными аппаратами (БПЛА) охватывают широкий спектр задач, включая автономную навигацию, координацию групповых действий и интеграцию различных систем управления. Одной из наиболее востребованных платформ является PX4 Autopilot, которая используется для управления полётами дронов в реальных и симуляционных средах. Эта платформа поддерживает различные протоколы связи, такие как MAVLink, и обеспечивает возможность интеграции с высокоуровневыми фреймворками.

Для разработки распределённых систем управления БПЛА активно применяется фреймворк ROS 2. Его использование позволяет создать модульные системы, где обмен данными между компонентами осуществляется через топики и сервисы. ROS 2 используется для реализации задач навигации, обхода препятствий, планирования траекторий и взаимодействия между дронами в роевых системах [3].

Одной из ключевых задач является координация действий групп дронов. В ряде исследований рассматриваются методы ройного интеллекта (Swarm Intelligence), позволяющие дронам действовать как единое целое. Например, алгоритмы, основанные на принципах обучения с подкреплением, успешно применяются для координации групповых действий в сложных динамических условиях [5]. Есть и другие подходы, например в работе Chen предложен метод поиска CC-MPSO, основанный на кооперативной коэволюции и кодировании движения, также исследуется модель движения цели на основе марковского процесса с учётом неопределённости движения цели [6].

Автономные системы управления также активно разрабатываются с использованием концепции высокоуровневых команд, таких как G-команды. Они позволяют стандартизировать взаимодействие между компонентами системы и обеспечивают удобство интеграции новых функциональных модулей [7]. Применение G-команд упрощает разработку сложных систем управления, обеспечивая их масштабируемость и совместимость.

### 3. **Архитектура системы**

Система управления беспилотными летательными аппаратами (БПЛА) построена на взаимодействии трёх основных компонентов: платформы автопилота PX4, фреймворка ROS 2 и высокоуровневого контроллера. PX4 SITL обеспечивает симуляцию полёта и обработку низкоуровневых команд, ROS 2 выступает в роли посредника для передачи данных и управления, а контроллер отвечает за обработку высокоуровневых команд и координацию действий дронов.

Связь между PX4 и ROS 2 реализована через MAVROS, использующий протокол MAVLink, что обеспечивает передачу команд и данных. Для маршрутизации сообщений используется Micro XRCE-DDS Agent, позволяющий эффективно обмениваться информацией в распределённой системе.

Архитектура и исходный код системы доступны в открытом доступе на GitHub: PX4 Multi-Drone Simulation Project [8].

**Модули системы:**

1. **Модуль управления полётом**: включает PX4 SITL и MAVROS. Он отвечает за обработку низкоуровневых команд и симуляцию полётов. Настройка параметров системы производится через YAML-файлы, что обеспечивает гибкость и адаптацию к различным сценариям.

2. **Модуль формирования среды**: создаёт симуляционное окружение и модели дронов. Используется стандартный мир "Wall" с возможностью добавления сенсоров (камер, лидаров) и изменения параметров среды. Описание объектов выполняется в формате SDF.

3. **Высокоуровневый контроллер**: управляет состояниями дронов (ожидание, армирование, взлёт, удержание позиции, посадка) и поддерживает системы координат ENU и NED для преобразования положений и ориентаций. Контроллер взаимодействует с MAVROS для передачи команд PX4.

4. **Модуль обработки G-команд**: принимает и интерпретирует команды в формате JSON, передаваемые через именованные каналы передачи данных. Команды задают высокоуровневую логику, такую как перемещение, взлёт, удержание позиции и посадка. Очередь команд обрабатывается последовательно.

5. **Модуль мониторинга и визуализации**: с помощью RViz обеспечивает отображение траекторий и состояний дронов в реальном времени. Этот модуль используется для анализа выполнения команд и диагностики системы.

6. **Модуль управления группой дронов**: реализует координацию нескольких дронов с использованием алгоритмов ройного интеллекта. Он поддерживает задачи, такие как избегание препятствий, движение в формации и достижение общих целей.

Передача данных и команд в системе реализована через именованные каналы передачи данных, что позволяет организовать обмен информацией между модулями. Примеры каналов:
- **Каналы команд G-кодов**: используются для передачи JSON-команд высокоуровневому контроллеру.
- **Каналы мониторинга**: содержат данные о состоянии дронов, их текущих и целевых позициях.
- **Очереди обработки команд**: обеспечивают последовательное выполнение задач, завершая текущую команду перед началом следующей.

Использование ROS 2 сервисов и именованных каналов передачи данных упрощает интеграцию новых функциональных модулей и обеспечивает масштабируемость системы. Такая архитектура позволяет эффективно управлять как отдельными дронами, так и их группами, обеспечивая стабильность и точность выполнения команд.

### 4. **Реализация высокоуровневого контроллера**

Высокоуровневые команды, реализованные в формате G-кодов, предназначены для управления действиями дрона. Они формируются в виде JSON-структур, передаваемых через именованные каналы передачи данных ROS 2. Каждая команда состоит из уникального идентификатора (`command`), параметров (`parameters`) и счётчика выполнения (`counter`). Например, команда для линейного перемещения дрона содержит параметры начала, конца координат, угла ориентации и скорость, а также систему ориентации в которой заданы координаты (ENU/NED, local/global).

Пример команды G21 для линейного перемещения, передаваемой через ROS 2, представлен ниже. Команда публикуется в именованный канал `/id_1_x500/in/command_json` в формате JSON [8]:

```bash
ros2 topic pub --once /id_1_x500/in/command_json std_msgs/msg/String "{data: '{
    \"name\": \"G21\",
    \"counter\": 2,
    \"start_point\": [0.0, 0.0, 0.0],
    \"end_point\": [5.0, 10.0, -10.0],
    \"velocity\": 1.5,
    \"yaw\": 1.57,
    \"coordinate_system\": \"global_ENU\"
}'}"
```

**Описание команды:**
- **name:** Идентификатор команды (G21), указывающий на задачу линейного перемещения.
- **counter:** Уникальный счётчик команды для отслеживания выполнения.
- **start_point:** Начальная точка перемещения в глобальной системе координат ENU.
- **end_point:** Конечная точка перемещения в глобальной системе координат ENU.
- **velocity:** Скорость перемещения (м/с).
- **yaw:** Угол ориентации (рад).
- **coordinate_system:** Система координат, в которой задано перемещение (в данном случае `global_ENU`).

Эта команда задаёт перемещение дрона из начальной точки `[0.0, 0.0, 0.0]` в конечную `[5.0, 10.0, -10.0]` с указанной скоростью, углом ориентации и использованием глобальной системы координат ENU.

Обработка G-команд организована следующим образом:
1. **Инициализация:** Команда передаётся через именованный канал, принимается контроллером и десериализуется.
2. **Выполнение:** Контроллер проверяет валидность команды и передаёт соответствующие параметры в автопилот PX4 через MAVROS. Выполнение команды сопровождается отслеживанием её прогресса.
3. **Завершение:** После выполнения команда помечается как завершённая, и управление передаётся следующей команде из очереди.

Команды обрабатываются последовательно, что упрощает управление и обеспечивает контроль за выполнением каждого действия. С полним список команд можно ознакомиться в исходном коде.

Для управления режимами работы дрона используется шаблон проектирования "Состояние". Каждый режим работы (например, ожидание, взлёт, удержание позиции, посадка) представлен отдельным классом, включающим методы для инициализации, выполнения и завершения состояния. Это обеспечивает модульность и гибкость системы, упрощая добавление новых режимов.

Поддерживаемые состояния:
- **Idle:** Ожидание. Начальное состояние после включения системы.
- **Arming:** Армирование дрона. Подготовка к полёту.
- **Takeoff:** Взлёт до заданной высоты.
- **Loiter:** Удержание текущей позиции.
- **Offboard:** Режим внешнего управления для точного выполнения заданных траекторий.
- **Landing:** Автоматическая посадка.
- **Disarm:** Завершение работы и перевод дрона в безопасное состояние.

Логика переходов между состояниями зависит от текущих параметров системы. Например, успешное армирование переводит дрон в состояние взлёта, а завершение взлёта — в режим удержания позиции.

Контроллер реализован на Python с использованием функциональности ROS 2 для обработки команд, управления состояниями и взаимодействия с MAVROS. Преимущества такого подхода включают:
- **Удобство работы с G-командами:** JSON-формат обеспечивает стандартизированное взаимодействие между модулями.
- **Гибкость разработки:** Python позволяет легко расширять функциональность контроллера.
- **Интеграция с ROS 2:** Использование ROS 2 сервисов и каналов передачи данных упрощает обмен информацией между модулями.

Периодическая передача команд с высокой частотой (например, 0.1 секунды) обеспечивает плавность управления и исключает активацию аварийных режимов. Такой подход гарантирует надёжность выполнения команд, даже в сложных сценариях полёта.

### 5. **Проведение эксперимента**

Для проведения эксперимента использовались современные инструменты и программное обеспечение, обеспечивающие управление, симуляцию и анализ данных. Основу системы составили фреймворк **ROS 2 Humble**, обеспечивающий модульную архитектуру и обмен данными через именованные каналы. В качестве симуляционной среды использовался **Gazebo**, предоставляющий реалистичное физическое моделирование и интеграцию с ROS 2. Управление дронами осуществлялось с помощью **PX4 Autopilot версии 1.14**, связанного с ROS через MAVROS.

Логика управления и обработка данных реализованы на языке программирования **Python 3.8**, благодаря его простоте и богатой экосистеме библиотек. Для визуализации траекторий и мониторинга состояния дронов применялся инструмент **RViz**, интегрированный с ROS. Для обеспечения изоляции среды разработки и упрощения развёртывания системы использовалась платформа контейнеризации **Docker**. Вся система разрабатывалась и тестировалась на базе операционной системы **Ubuntu 22.04 LTS**. 

Эксперимент направлен на проверку координации и взаимодействия группы беспилотных летательных аппаратов (БЛА) в общей среде. Основными задачами являлись тестирование системы управления несколькими дронами, оценка выполнения последовательности команд и анализ устойчивости при одновременном управлении несколькими объектами. Управление осуществлялось в стандартной симуляционной среде *default*


Дроны размещались в стартовых координатах на высоте 0 метров. Для создания безопасного пространства для манёвров первым шагом каждой программы была команда на взлёт, с перемещением аппаратов в начальную высоту 5 метров.

Каждому дрону отправлялись уникальные команды, выполненные через именованные каналы передачи данных ROS 2.
**Первый дрон (id_1):** Выполнил перемещение на 5 метров вперёд с углом ориентации 1.57 радиан (90°) и скоростью 2.0 м/с в локальной системе координат ENU.  
 _Рисунок – Визуализация выполнения команды первым дроном._

**Второй дрон (id_2):** Выполнил линейное перемещение от точки (-5, 0, 5) до точки (-5, -5, 5) с постоянной скоростью 1.5 м/с.  
 _Рисунок – Визуализация выполнения команды вторым дроном._

**Третий дрон (id_3):** Выполнил движение по дуге радиусом 3 метра между точками (0, 0, 5) и (5, 0, 5), в направлении против часовой стрелки, с образованием 10 
 _Рисунок – Визуализация выполнения команды третьим дроном._


### 6. **Анализ  результатов**

В ходе эксперимента были выявлены несколько недочётов, которые необходимо учитывать при дальнейшем совершенствовании системы. Во время размещения группы дронов (3 единицы) в начальных координатах была зафиксирована значительная погрешность. Хотя данные с датчиков указывали на нахождение дронов в заданных координатах (_Рисунок, справа_), в симуляционной среде визуально наблюдалось расхождение фактических позиций (_Рисунок, слева_). Это отклонение становилось особенно заметным после выполнения команд на взлёт, что подтверждается результатами визуализации.

Причина выявленной разницы между заявленными и фактическими позициями, вероятно, связана с особенностями работы модели автопилота PX4 в симуляционной среде. Такие отклонения могут быть вызваны задержками в обработке команд, несовершенством математической модели системы или погрешностями передачи данных через симуляционную платформу.

Анализ выполнения команд для каждого дрона по отдельности продемонстрировал корректность их обработки и адекватность управления. Например, команды на перемещение к заданным координатам были выполнены визуально корректно, что подтверждается данными визуализации траекторий в *Gazebo* и *RViz*.

Таким образом, несмотря на обнаруженные недочёты в начальной конфигурации позиций, система продемонстрировала стабильность и точность при выполнении заданных команд. Это подтверждает её готовность к дальнейшим испытаниям и возможное использование в более сложных сценариях. Однако в будущих разработках необходимо сосредоточить внимание на улучшении точности начального размещения и минимизации погрешностей, связанных с симуляцией.

### 7. **Заключение**

### Заключение

Была разработана и протестирована система управления группой беспилотных летательных аппаратов (БЛА) с использованием фреймворка ROS 2, ПО управления полётом PX4 и симуляционной среды Gazebo. Основное внимание уделялось базовым алгоритмам управления, координации дронов и тестированию системы в одиночных и групповых сценариях.

Эксперименты показали, что система способна корректно выполнять команды, включая взлёт, перемещение и зависание, а также продемонстрировала устойчивость при выполнении различных задач. Тем не менее, выявлены погрешности в начальном позиционировании дронов и временная асинхронность при групповом выполнении команд, что требует дальнейших доработок.

Будущее развитие системы предполагает устранение выявленных недостатков, улучшение механизма синхронизации команд, создание графического интерфейса пользователя и внедрение модулей одометрии и автономной навигации. Это повысит точность, надёжность и функциональность системы, делая её более эффективной для применения в реальных условиях.

### **Список литературы**

1. Meier, L., Honegger, D., Pollefeys, M. PX4: A node-based multithreaded open source robotics framework for deeply embedded platforms // Proceedings - IEEE International Conference on Robotics and Automation. 2015. Vol. 2015. P. 6235-6240. DOI: 10.1109/ICRA.2015.7140074.

2. ArduPilot Development Team. ArduPilot Documentation [Электронный ресурс]. URL: https://ardupilot.org/ (дата обращения: 24.01.2025).

3. Macenski, S., Foote, T., Gerkey, B., Lalancette, C., Woodall, W. Robot Operating System 2: Design, Architecture, and Uses In The Wild. 2022. DOI: 10.48550/arXiv.2211.07752.

4. Abolarin, V. Generating G and M Code for Lathe Machine Using Python // 2024. Sep.

5. A Multi-Drone System Proof of Concept for Forestry Applications // Drones. 2025. Vol. 9. P. 80. DOI: 10.3390/drones9020080.

6. Chen, W., Fu, B., Wu, Z., Hao, L., Yang, G. Research on Dynamic Target Search for Multi-UAV Based on Cooperative Coevolution Motion-Encoded Particle Swarm Optimization // Applied Sciences. 2024. Vol. 14. P. 1326. DOI: 10.3390/app14041326.

7. Luan, N., Chen, J., Yan, Y. An Extended G-Code to be used on Networked Industrial Robots // International Journal of Robotics & Automation. 2004. Vol. 19. DOI: 10.2316/Journal.206.2004.2.206-2725.

8. Pisarenko, A. PX4 Multi-Drone Simulation Project [Электронный ресурс]. URL: https://github.com/AntonSHBK/px4_multi_drone_sim (дата обращения: 24.12.2024).